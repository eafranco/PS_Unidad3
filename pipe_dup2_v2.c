#include <sys/types.h>#include <fcntl.h>#include <unistd.h>#include <stdio.h>#define COMMAND1 "cat"#define COMMAND2 "grep"#define COMMAND3 "wc"#include <stdlib.h>//funciona igual que  cat /etc/passwd | grep bash |wc -lint main( int argc, char **argv ){	pid_t pid, pid2;	int p[2], p2[2];	pipe(p);	if ( (pid=fork()) == 0 )	{ // hijo		close(p[0]); /* cerramos el lado de lectura del pipe */		dup2(p[1], 1); /* STDOUT = extremo de salida del pipe */		close(p[1]); /* cerramos el descriptor de fichero que sobra Ð escritura Ð tras el dup2 */		execlp(COMMAND1, COMMAND1, argv[1], NULL);		perror("error"); /* si estamos aqu’, algo ha fallado */		_exit(1); /* salir sin flush */	}	else		{ // padre			pipe(p2);			if ( (pid2=fork()) == 0 )			{ // segundo hijo						dup2(p[0], 0); /* 0=STDIN = extremo de entrada del pipe */			close(p[0]); /* cerramos el descriptor de fichero que sobra tras el dup2 */						dup2(p2[1], 1);  /*conectamos pipe 2 */			close(p2[1]); /* cerramos el lado de escritura del pipe 2*/						execlp(COMMAND2, COMMAND2,"main", NULL);			perror("error"); /* si estamos aqui, algo ha fallado */			exit(1); /* salir con flush */			}			else { /* al final el padre */				printf("Llego al padre\n");				close(p2[1]);				dup2(p2[0], 0); /* 0=STDIN = extremo de entrada del pipe */				close(p2[0]); /* cerramos el descriptor de fichero que sobra tras el dup2 */								execlp(COMMAND3, COMMAND3, NULL);				perror("error"); /* si estamos aqui, algo ha fallado */						    }		}    waitpid( pid, NULL, 0 );    waitpid( pid2, NULL, 0 );	return 0;}